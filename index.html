<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application de Gestion de Construction</title>
    
    <!-- TailwindCSS EN PREMIER -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Styles personnalis√©s -->
    <style>
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Point de montage de l'application React -->
    <div id="root">
        <div style="padding: 40px; text-align: center; font-family: system-ui;">
            <h1 style="font-size: 24px; margin-bottom: 20px;">‚è≥ Chargement de l'application...</h1>
            <p style="color: #666;">Veuillez patienter pendant le chargement des composants.</p>
        </div>
    </div>
    
    <!-- Chargement s√©quentiel des biblioth√®ques -->
    <script>
        console.log('üîµ D√©but du chargement...');
        
        // Fonction pour charger les scripts dans l'ordre
        function loadScript(src, type = 'text/javascript') {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                if (type === 'babel') {
                    script.type = 'text/babel';
                    script.setAttribute('data-type', 'module');
                } else {
                    script.type = type;
                }
                script.onload = () => {
                    console.log('‚úÖ Charg√©:', src);
                    resolve();
                };
                script.onerror = () => {
                    console.error('‚ùå Erreur:', src);
                    reject(new Error(`Impossible de charger ${src}`));
                };
                document.body.appendChild(script);
            });
        }
        
        // Fonction pour charger tous les scripts
        async function loadAllScripts() {
            try {
                // 1. React et ReactDOM
                console.log('üì¶ Chargement de React...');
                await loadScript('https://unpkg.com/react@18/umd/react.development.js');
                await loadScript('https://unpkg.com/react-dom@18/umd/react-dom.development.js');
                console.log('‚úÖ React charg√©');
                
                // 2. Babel (n√©cessaire pour JSX)
                console.log('üì¶ Chargement de Babel...');
                await loadScript('https://unpkg.com/@babel/standalone/babel.min.js');
                console.log('‚úÖ Babel charg√©');
                
                // Petite pause pour que Babel s'initialise
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 3. OneDrive
                console.log('üì¶ Chargement OneDrive...');
                await loadScript('https://js.live.net/v7.2/OneDrive.js');
                
                // 4. Utilitaires (ordre important !)
                console.log('üì¶ Chargement des utilitaires...');
                await loadScript('utils/icons.js', 'babel');
                await loadScript('utils/storage.js', 'babel');
                await loadScript('utils/export.js', 'babel');
                await loadScript('utils/individual-exports.js');
                await loadScript('utils/onedrive-helper.js');
                
                // 5. Composants utilitaires
                console.log('üì¶ Chargement des composants utilitaires...');
                await loadScript('components/SmartTable.js', 'babel');
                await loadScript('components/SmartSelector.js', 'babel');
                await loadScript('components/SessionManager.js', 'babel');
                await loadScript('components/EstimationBuilder.js', 'babel');
                
                // 6. Modals
                console.log('üì¶ Chargement des modals...');
                await loadScript('components/ImportModal.js', 'babel');
                await loadScript('components/ExportModal.js', 'babel');
                await loadScript('components/OffreModal.js', 'babel');
                await loadScript('components/OffreComplementaireModal.js', 'babel');
                await loadScript('components/OneDriveConfigModal.js');
                await loadScript('components/AppelOffreModal.js', 'babel');
                await loadScript('components/AppelOffreDetailView.js', 'babel');
                await loadScript('components/CommandeModal.js', 'babel');
                await loadScript('components/RegieModal.js', 'babel');
                await loadScript('components/FactureModal.js', 'babel');
                
                // 7. Vues
                console.log('üì¶ Chargement des vues...');
                await loadScript('components/Dashboard.js', 'babel');
                await loadScript('components/AlignementView.js', 'babel');
                await loadScript('components/AjustementModal.js', 'babel');
                await loadScript('components/AlignementBudgetaire.js', 'babel');
                
                // 8. Application principale
                console.log('üì¶ Chargement de l\'application...');
                await loadScript('app.js', 'babel');
                
                // Attendre que Babel transforme tous les scripts
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // V√©rifications finales
                console.log('=== V√âRIFICATION FINALE ===');
                console.log('React:', typeof React !== 'undefined' ? '‚úÖ' : '‚ùå');
                console.log('ReactDOM:', typeof ReactDOM !== 'undefined' ? '‚úÖ' : '‚ùå');
                console.log('Icons:', typeof window.Icons !== 'undefined' ? '‚úÖ' : '‚ùå');
                console.log('Storage:', typeof window.storage !== 'undefined' ? '‚úÖ' : '‚ùå');
                console.log('AlignementView:', typeof window.AlignementView !== 'undefined' ? '‚úÖ' : '‚ùå');
                
                // V√©rifier si l'app s'est mont√©e
                setTimeout(() => {
                    const root = document.getElementById('root');
                    if (root && root.children.length <= 1) {
                        console.error('‚ùå L\'application ne s\'est pas mont√©e !');
                        root.innerHTML = `
                            <div style="padding: 40px; max-width: 800px; margin: 0 auto; font-family: system-ui;">
                                <h1 style="color: #dc2626; font-size: 24px; margin-bottom: 20px;">
                                    ‚ö†Ô∏è Erreur de chargement
                                </h1>
                                <p>L'application n'a pas pu d√©marrer. V√©rifiez la console (F12).</p>
                            </div>
                        `;
                    } else {
                        console.log('üéâ Application d√©marr√©e avec succ√®s !');
                    }
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Erreur fatale:', error);
                document.getElementById('root').innerHTML = `
                    <div style="padding: 40px; max-width: 800px; margin: 0 auto; font-family: system-ui;">
                        <h1 style="color: #dc2626; font-size: 24px; margin-bottom: 20px;">
                            ‚ùå Erreur de chargement
                        </h1>
                        <p style="margin-bottom: 15px;">Une erreur s'est produite lors du chargement :</p>
                        <pre style="background: #fee; padding: 15px; border-radius: 5px; overflow-x: auto;">
${error.message}
                        </pre>
                        <p style="margin-top: 15px; color: #666;">
                            V√©rifiez que tous les fichiers sont pr√©sents et que les chemins sont corrects.
                        </p>
                    </div>
                `;
            }
        }
        
        // D√©marrer le chargement quand le DOM est pr√™t
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadAllScripts);
        } else {
            loadAllScripts();
        }
    </script>
</body>
</html>
